/**
 * @file Скрипт начального заполнения базы данных (seed)
 * @description Создает начальные категории задач в базе данных.
 * Запускается вручную при первоначальной настройке проекта:
 *   npx ts-node prisma/seed.ts
 *
 * Использует upsert для идемпотентности — при повторном запуске не создает дубликаты.
 * Если категория с таким именем уже существует, она не обновляется (update: {}).
 *
 * Начальные категории:
 * - Работа (синий #3b82f6) — рабочие задачи
 * - Личное (зелёный #10b981) — личные дела
 * - Учеба (жёлтый #f59e0b) — учебные задачи
 * - Здоровье (красный #ef4444) — задачи, связанные со здоровьем
 */

import { PrismaClient } from "@prisma/client"

// Создаем отдельный экземпляр PrismaClient для seed-скрипта
// (не используем глобальный singleton из lib/db.ts, так как это отдельный процесс)
const prisma = new PrismaClient()

/**
 * Основная функция заполнения БД.
 * Создает начальные категории задач через upsert (вставка или пропуск).
 */
async function main() {
  // Определяем начальные категории с названиями и цветами
  const categories = [
    { name: "Работа", color: "#3b82f6" },    // Синий — рабочие задачи
    { name: "Личное", color: "#10b981" },     // Зелёный — личные дела
    { name: "Учеба", color: "#f59e0b" },      // Жёлтый — учебные задачи
    { name: "Здоровье", color: "#ef4444" },   // Красный — здоровье
  ]

  // Создаем категории через upsert — если уже существует, пропускаем
  for (const category of categories) {
    await prisma.category.upsert({
      where: { name: category.name }, // Ищем по уникальному имени
      update: {},                      // При существовании — ничего не обновляем
      create: category,                // При отсутствии — создаем
    })
  }

  console.log("Категории созданы")
}

// Запускаем seed-скрипт и обрабатываем ошибки
main()
  .catch((e) => {
    console.error(e)
    process.exit(1) // Завершаем процесс с кодом ошибки
  })
  .finally(async () => {
    // Обязательно отключаемся от БД после завершения скрипта
    await prisma.$disconnect()
  })
